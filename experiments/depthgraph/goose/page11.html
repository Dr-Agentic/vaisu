<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goose Depth Graph - Sector Hierarchy (11)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../styles.css" rel="stylesheet">
    <script src="../data.js"></script>
</head>
<body class="bg-[var(--color-background-primary)] text-[var(--color-text-primary)] p-8">
    <div id="root"></div>

    <script type="text/babel">
        // --- Card Components ---
        const variantStyles = {
            base: 'bg-[var(--color-surface-base)] border border-[var(--color-border-base)]',
            elevated: 'bg-[var(--color-surface-elevated)] shadow-[var(--elevation-md)] border border-[var(--color-border-base)]',
            outlined: 'bg-[var(--color-surface-base)] border-2 border-[var(--color-border-strong)]',
            filled: 'bg-[var(--color-background-secondary)] border border-[var(--color-border-base)]',
        };

        const Card = ({ variant = 'base', className = '', interactive = false, children, ...props }) => (
            <div 
                className={`
                    rounded-[var(--radius-xl)] p-4
                    ${variantStyles[variant] || variantStyles.base}
                    ${interactive ? 'transition-all duration-200 hover:-translate-y-1 hover:shadow-[var(--elevation-lg)] cursor-pointer' : ''}
                    ${className}
                `} 
                {...props}
            >
                {children}
            </div>
        );

        const Badge = ({ children, type = 'default' }) => {
            const colors = {
                default: 'bg-[var(--color-surface-base)] border-[var(--color-border-subtle)] text-[var(--color-text-secondary)]',
                primary: 'bg-[rgba(99,102,241,0.2)] border-[var(--aurora-1)] text-[var(--aurora-1)]',
                success: 'bg-[rgba(34,197,94,0.2)] border-[var(--color-semantic-success-base)] text-[var(--color-semantic-success-base)]',
                warning: 'bg-[rgba(245,158,11,0.2)] border-[var(--color-semantic-warning-base)] text-[var(--color-semantic-warning-base)]',
            };
            return (
                <span className={`px-2 py-1 rounded-[var(--radius-base)] text-xs font-medium border ${colors[type]}`}>
                    {children}
                </span>
            );
        };

        // --- Main App ---
        const App = () => {
            const [expandedNodes, setExpandedNodes] = React.useState(new Set());

            // Categorize nodes into sectors based on topic patterns
            const sectors = {
                'Macro & Thesis': GRAPH_DATA.filter(n => n.id <= 2),
                'Economic Structure': GRAPH_DATA.filter(n => n.id >= 3 && n.id <= 5),
                'Organizational Change': GRAPH_DATA.filter(n => n.id >= 6 && n.id <= 7),
                'Employment Data': GRAPH_DATA.filter(n => n.id >= 8 && n.id <= 10),
                'Sector Analysis': GRAPH_DATA.filter(n => n.id >= 11 && n.id <= 12),
                'Systemic Impact': GRAPH_DATA.filter(n => n.id >= 13 && n.id <= 15),
            };

            const toggleExpand = (id) => {
                const newExpanded = new Set(expandedNodes);
                if (newExpanded.has(id)) {
                    newExpanded.delete(id);
                } else {
                    newExpanded.add(id);
                }
                setExpandedNodes(newExpanded);
            };

            const getDepthColor = (depth) => {
                if (depth >= 8.5) return 'var(--aurora-1)';
                if (depth >= 8.0) return 'var(--nova-1)';
                if (depth >= 7.0) return 'var(--color-text-primary)';
                return 'var(--color-text-disabled)';
            };

            return (
                <div className="max-w-[1800px] mx-auto space-y-12">
                    <header className="mb-8">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h1 className="text-4xl font-bold mb-2 text-gradient aurora">
                                    Sector Hierarchy Visualization
                                </h1>
                                <p className="text-[var(--color-text-secondary)] text-lg">
                                    Experiment 11: Grouping nodes by thematic sectors with progressive disclosure
                                </p>
                            </div>
                            <div className="flex gap-2">
                                <a href="page12.html" className="btn btn-secondary px-4 py-2 rounded-lg text-sm">Next â†’</a>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-[var(--color-text-secondary)]">
                            <Badge type="primary">Thesis</Badge>
                            <Badge type="default">Economic</Badge>
                            <Badge type="warning">Organizational</Badge>
                            <Badge type="success">Data</Badge>
                            <Badge type="default">Sector</Badge>
                            <Badge type="primary">Systemic</Badge>
                        </div>
                    </header>

                    {Object.entries(sectors).map(([sectorName, nodes]) => (
                        <section key={sectorName} className="space-y-4">
                            <div className="flex items-center gap-3 border-b border-[var(--color-border-subtle)] pb-2">
                                <h2 className="text-xl font-semibold text-gradient nova">{sectorName}</h2>
                                <span className="text-xs text-[var(--color-text-tertiary)]">({nodes.length} nodes)</span>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                {nodes.map((node) => {
                                    const isExpanded = expandedNodes.has(node.id);
                                    const depthColor = getDepthColor(node.true_depth);
                                    
                                    return (
                                        <Card 
                                            key={node.id}
                                            variant={isExpanded ? "outlined" : "elevated"}
                                            interactive={true}
                                            onClick={() => toggleExpand(node.id)}
                                            className={`relative overflow-hidden ${isExpanded ? 'md:col-span-2' : ''}`}
                                        >
                                            <div className="absolute top-3 right-3 flex items-center gap-2">
                                                <span className="text-[10px] font-mono text-[var(--color-text-disabled)]">#{node.id}</span>
                                                <div 
                                                    className="w-2 h-2 rounded-full" 
                                                    style={{ backgroundColor: depthColor }}
                                                    title={`Depth: ${node.true_depth}`}
                                                ></div>
                                            </div>

                                            <div className="space-y-2">
                                                <h3 className="font-bold text-[var(--color-text-primary)] pr-12">
                                                    {node.topic}
                                                </h3>
                                                <p className="text-sm text-[var(--color-text-secondary)] line-clamp-2">
                                                    {node.topic_summary}
                                                </p>
                                            </div>

                                            {isExpanded && (
                                                <div className="mt-4 pt-4 border-t border-[var(--color-border-subtle)] space-y-3 animate-fade-in">
                                                    <p className="text-xs leading-relaxed text-[var(--color-text-primary)]">
                                                        {node.extended_summary}
                                                    </p>
                                                    
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <div className="bg-[var(--color-background-tertiary)] p-2 rounded">
                                                            <div className="text-[10px] text-[var(--color-text-tertiary)]">Cognitive</div>
                                                            <div className="font-mono font-bold">{node.cognitive}</div>
                                                        </div>
                                                        <div className="bg-[var(--color-background-tertiary)] p-2 rounded">
                                                            <div className="text-[10px] text-[var(--color-text-tertiary)]">Causal</div>
                                                            <div className="font-mono font-bold">{node.causal}</div>
                                                        </div>
                                                    </div>

                                                    {node.signals.grounding.length > 0 && (
                                                        <div className="flex flex-wrap gap-1">
                                                            {node.signals.grounding.map((s, i) => (
                                                                <span key={i} className="px-2 py-0.5 text-[10px] bg-[var(--color-surface-base)] border border-[var(--color-border-subtle)] rounded-full">
                                                                    {s}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </Card>
                                    );
                                })}
                            </div>
                        </section>
                    ))}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
