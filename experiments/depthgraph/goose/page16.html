<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goose Depth Graph - Contour Cascade (16)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../styles.css" rel="stylesheet">
    <script src="../data.js"></script>
    <!-- 
      EXCEPTION: CSS custom property --indent-level for dynamic indentation
      plus explicit width constraints for card layout
    -->
    <style>
        .cascade-node {
            --indent-level: 0;
            margin-left: calc(var(--indent-level) * 2.5rem);
            position: relative;
            transition: margin-left 0.2s ease;
        }
        
        .cascade-node::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 1.5rem;
            width: 1.5rem;
            height: 1px;
            background: var(--color-border-subtle);
        }

        .cascade-node:first-child::before {
            display: none;
        }

        .node-connector-line {
            position: absolute;
            left: 0;
            top: 50%;
            width: 1rem;
            height: 1px;
            background: var(--color-border-subtle);
            transform: translateX(-100%);
        }

        .contour-card {
            max-width: 850px;
            border: 2px solid var(--color-border-base);
            transition: border-color 0.2s ease;
        }

        .contour-card:hover {
            border-color: var(--aurora-1);
        }

        .contour-card.expanded {
            border-color: var(--aurora-1);
            background: rgba(99, 102, 241, 0.03);
        }

        /* Layout for expanded card content */
        .expanded-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .detail-section {
            background: var(--color-surface-base);
            border: 1px solid var(--color-border-subtle);
            border-radius: 8px;
            padding: 1rem;
        }

        .detail-section h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-tertiary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .metric-box {
            background: var(--color-background-tertiary);
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: bold;
            font-family: monospace;
        }

        .metric-label {
            font-size: 0.65rem;
            color: var(--color-text-tertiary);
            text-transform: uppercase;
        }

        .signal-tag {
            display: inline-block;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--aurora-1);
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin: 0.125rem;
        }

        .signal-tag.nuance {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.3);
            color: var(--nova-1);
        }

        .depth-bar {
            height: 4px;
            background: var(--color-border-subtle);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .depth-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--aurora-1), var(--nova-1));
            transition: width 0.3s ease;
        }

        .node-id-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: var(--color-background-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-family: monospace;
            font-weight: bold;
            color: var(--color-text-tertiary);
        }

        .expand-indicator {
            position: absolute;
            bottom: 0.75rem;
            right: 0.75rem;
            width: 24px;
            height: 24px;
            border: 1px solid var(--color-border-subtle);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--color-text-secondary);
            transition: all 0.2s ease;
        }

        .expanded .expand-indicator {
            background: var(--aurora-1);
            color: white;
            border-color: var(--aurora-1);
            transform: rotate(180deg);
        }

        .level-indicator {
            position: absolute;
            left: -2.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            border: 2px solid var(--color-border-subtle);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--color-text-tertiary);
            background: var(--color-surface-base);
        }

        .cascade-node:hover .level-indicator {
            border-color: var(--aurora-1);
            color: var(--aurora-1);
        }
    </style>
</head>
<body class="bg-[var(--color-background-primary)] text-[var(--color-text-primary)] p-8">
    <div id="root"></div>

    <script type="text/babel">
        // --- Card Component ---
        const ContourCard = ({ node, level, isExpanded, onToggle }) => {
            const depthPercent = (node.true_depth / 10) * 100;
            const allData = node.dimensionDetails;
            
            return (
                <div 
                    className={`
                        cascade-node relative mb-3 cursor-pointer
                        contour-card
                        ${isExpanded ? 'expanded' : ''}
                    `}
                    style={{ '--indent-level': level }}
                    onClick={() => onToggle(node.id)}
                >
                    {/* Level Indicator */}
                    <div className="level-indicator">{level}</div>
                    
                    {/* Node Connector */}
                    <div className="node-connector-line"></div>

                    {/* Badge & Indicator */}
                    <div className="node-id-badge">#{node.id}</div>
                    <div className="expand-indicator">
                        {isExpanded ? '−' : '+'}
                    </div>

                    {/* Main Content */}
                    <div className="p-5">
                        <div className="flex items-start gap-4">
                            <div className="flex-1">
                                <div className="flex items-center justify-between mb-2">
                                    <h3 className="font-bold text-[var(--color-text-primary)] text-lg pr-12">
                                        {node.topic}
                                    </h3>
                                </div>
                                <p className="text-sm text-[var(--color-text-secondary)] mb-2">
                                    {node.topic_summary}
                                </p>

                                {/* Depth Indicator */}
                                <div className="depth-bar">
                                    <div 
                                        className="depth-fill" 
                                        style={{ width: `${depthPercent}%` }}
                                        title={`Depth: ${node.true_depth}`}
                                    ></div>
                                </div>

                                {/* Quick Metrics Row */}
                                <div className="flex gap-4 mt-3 text-xs text-[var(--color-text-tertiary)]">
                                    <span>Depth: <strong className="text-[var(--color-text-primary)]">{node.true_depth}</strong></span>
                                    <span>Cog: <strong className="text-[var(--color-text-primary)]">{node.cognitive}</strong></span>
                                    <span>Epi: <strong className="text-[var(--color-text-primary)]">{node.epistemic}</strong></span>
                                    <span>Cau: <strong className="text-[var(--color-text-primary)]">{node.causal}</strong></span>
                                </div>

                                {/* Signals Preview */}
                                {node.signals.grounding.length > 0 && !isExpanded && (
                                    <div className="flex gap-1 mt-2 overflow-x-hidden">
                                        {node.signals.grounding.slice(0, 2).map((s, i) => (
                                            <span key={i} className="signal-tag">{s}</span>
                                        ))}
                                        {node.signals.grounding.length > 2 && (
                                            <span className="text-xs text-[var(--color-text-tertiary)]">+{node.signals.grounding.length - 2} more</span>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Expanded Content - Full Data Display */}
                        {isExpanded && (
                            <div className="animate-fade-in mt-4 pt-4 border-t border-[var(--color-border-subtle)]">
                                <div className="expanded-grid">
                                    {/* Left Column: Extended Info */}
                                    <div className="space-y-3">
                                        <div className="detail-section">
                                            <h4>Extended Summary</h4>
                                            <p className="text-sm leading-relaxed text-[var(--color-text-primary)]">
                                                {node.extended_summary}
                                            </p>
                                        </div>

                                        <div className="detail-section">
                                            <h4>Feedback & Insights</h4>
                                            <p className="text-sm text-[var(--color-text-primary)]">
                                                {node.feedback || "No feedback provided."}
                                            </p>
                                            <div className="mt-2 text-xs text-[var(--color-text-secondary)]">
                                                <strong>Cognitive Level:</strong> {node.additionalInfo.cognitive_level}<br />
                                                <strong>Epistemic Level:</strong> {node.additionalInfo.epistemic_level}<br />
                                                <strong>Preview:</strong> {node.additionalInfo.text_preview}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Right Column: Detailed Metrics */}
                                    <div className="space-y-3">
                                        <div className="detail-section">
                                            <h4>Dimension Details</h4>
                                            <div className="space-y-2">
                                                {Object.entries(allData).map(([key, value]) => (
                                                    <div key={key} className="text-xs">
                                                        <span className="font-semibold text-[var(--aurora-1)] capitalize">{key}: </span>
                                                        <span className="text-[var(--color-text-secondary)]">{value}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="detail-section">
                                            <h4>All Metrics</h4>
                                            <div className="metric-grid">
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.cognitive}</div>
                                                    <div className="metric-label">Cognitive</div>
                                                </div>
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.epistemic}</div>
                                                    <div className="metric-label">Epistemic</div>
                                                </div>
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.causal}</div>
                                                    <div className="metric-label">Causal</div>
                                                </div>
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.rigor}</div>
                                                    <div className="metric-label">Rigor</div>
                                                </div>
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.coherence}</div>
                                                    <div className="metric-label">Coherence</div>
                                                </div>
                                                <div className="metric-box">
                                                    <div className="metric-value">{node.true_depth}</div>
                                                    <div className="metric-label">True Depth</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="detail-section">
                                            <h4>Signals & Grounding</h4>
                                            <div className="flex flex-wrap gap-1">
                                                {node.signals.grounding.map((s, i) => (
                                                    <span key={i} className="signal-tag">{s}</span>
                                                ))}
                                            </div>
                                            {node.signals.nuance && node.signals.nuance.length > 0 && (
                                                <>
                                                    <h4 className="mt-2">Nuance</h4>
                                                    <div className="flex flex-wrap gap-1">
                                                        {node.signals.nuance.map((s, i) => (
                                                            <span key={i} className="signal-tag nuance">{s}</span>
                                                        ))}
                                                    </div>
                                                </>
                                            )}
                                        </div>

                                        <div className="detail-section">
                                            <h4>Additional Info</h4>
                                            <div className="text-xs text-[var(--color-text-secondary)] space-y-1">
                                                <div><strong>Coherence Analysis:</strong> {node.additionalInfo.coherence_analysis}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [expandedIds, setExpandedIds] = React.useState(new Set([1]));
            const [flowMode, setFlowMode] = React.useState('structural');

            // Structural hierarchy (same as page 15)
            const cascadeStructure = {
                structural: [
                    { id: 1, level: 0 }, // Thesis
                    { id: 2, level: 1 }, // Macro
                    { id: 3, level: 2 }, // K-Shaped
                    { id: 4, level: 2 }, // Wage Paradox
                    { id: 5, level: 2 }, // Silent Firing
                    { id: 6, level: 3 }, // Flattening
                    { id: 7, level: 3 }, // Agentic
                    { id: 8, level: 2 }, // Layoffs
                    { id: 9, level: 3 }, // Tech Sector
                    { id: 10, level: 3 }, // BPO
                    { id: 11, level: 3 }, // Prof Services
                    { id: 12, level: 3 }, // Creative
                    { id: 13, level: 2 }, // Entry Crisis
                    { id: 14, level: 3 }, // Social/Psych
                    { id: 15, level: 3 }, // Policy
                ],
                depth: GRAPH_DATA
                    .map(n => ({ id: n.id, level: 0 }))
                    .sort((a, b) => {
                        const nodeA = GRAPH_DATA.find(n => n.id === a.id);
                        const nodeB = GRAPH_DATA.find(n => n.id === b.id);
                        return nodeB.true_depth - nodeA.true_depth;
                    })
            };

            const toggleNode = (id) => {
                const newExpanded = new Set(expandedIds);
                if (newExpanded.has(id)) {
                    newExpanded.delete(id);
                } else {
                    newExpanded.add(id);
                }
                setExpandedIds(newExpanded);
            };

            const expandAll = () => {
                setExpandedIds(new Set(GRAPH_DATA.map(n => n.id)));
            };

            const collapseAll = () => {
                setExpandedIds(new Set([1]));
            };

            const currentStructure = cascadeStructure[flowMode];

            return (
                <div className="max-w-[1200px] mx-auto space-y-6">
                    <header className="mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h1 className="text-4xl font-bold mb-2 text-gradient aurora">
                                    Contour Cascade View
                                </h1>
                                <p className="text-[var(--color-text-secondary)] text-lg">
                                    Experiment 16: Enhanced hierarchy with full data visibility
                                </p>
                            </div>
                            <div className="flex gap-2">
                                <a href="page15.html" className="btn btn-secondary px-4 py-2 rounded-lg text-sm">← Page 15</a>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="bg-[var(--color-surface-elevated)] rounded-xl border border-[var(--color-border-base)] p-4">
                            <div className="flex items-center justify-between flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <span className="text-sm font-bold text-[var(--color-text-secondary)]">Mode:</span>
                                    <button 
                                        onClick={() => setFlowMode('structural')}
                                        className={`px-3 py-1.5 rounded-lg text-sm ${flowMode === 'structural' ? 'bg-[var(--aurora-1)] text-white' : 'bg-[var(--color-background-secondary)] border border-[var(--color-border-base)]'}`}
                                    >
                                        Structural
                                    </button>
                                    <button 
                                        onClick={() => setFlowMode('depth')}
                                        className={`px-3 py-1.5 rounded-lg text-sm ${flowMode === 'depth' ? 'bg-[var(--aurora-1)] text-white' : 'bg-[var(--color-background-secondary)] border border-[var(--color-border-base)]'}`}
                                    >
                                        By Depth
                                    </button>
                                </div>

                                <div className="flex items-center gap-2">
                                    <button onClick={expandAll} className="px-3 py-1.5 text-xs rounded bg-[var(--color-background-secondary)] hover:bg-[var(--color-background-tertiary)] border border-[var(--color-border-base)]">
                                        Expand All
                                    </button>
                                    <button onClick={collapseAll} className="px-3 py-1.5 text-xs rounded bg-[var(--color-background-secondary)] hover:bg-[var(--color-background-tertiary)] border border-[var(--color-border-base)]">
                                        Collapse All
                                    </button>
                                </div>
                            </div>

                            <div className="mt-3 text-xs text-[var(--color-text-secondary)]">
                                {currentStructure.length} nodes • {expandedIds.size} expanded • Cards show full node data when expanded
                            </div>
                        </div>
                    </header>

                    {/* Main Cascade */}
                    <div className="space-y-2 pb-12">
                        {currentStructure.map((item) => {
                            const node = GRAPH_DATA.find(n => n.id === item.id);
                            const isExpanded = expandedIds.has(node.id);
                            
                            return (
                                <ContourCard
                                    key={node.id}
                                    node={node}
                                    level={item.level}
                                    isExpanded={isExpanded}
                                    onToggle={toggleNode}
                                />
                            );
                        })}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
