<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goose Depth Graph - Progressive Timeline (13)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../styles.css" rel="stylesheet">
    <script src="../data.js"></script>
</head>
<body class="bg-[var(--color-background-primary)] text-[var(--color-text-primary)] p-8">
    <div id="root"></div>

    <script type="text/babel">
        // --- Card Components ---
        const Card = ({ className = '', children, ...props }) => (
            <div 
                className={`rounded-xl p-4 bg-[var(--color-surface-elevated)] border border-[var(--color-border-base)] ${className}`} 
                {...props}
            >
                {children}
            </div>
        );

        const TimelineConnector = ({ active, passed }) => {
            return (
                <div className={`w-1 h-12 mx-auto transition-all duration-300 ${passed ? 'bg-gradient-to-b from-[var(--aurora-1)] to-[var(--aurora-2)]' : 'bg-[var(--color-border-subtle)]'}`}></div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [currentStage, setCurrentStage] = React.useState(0);

            // Stage-based grouping
            const stages = [
                {
                    name: "Foundation",
                    description: "The thesis establishing decoupling",
                    nodes: [1],
                    icon: "üèõÔ∏è"
                },
                {
                    name: "Macro Analysis",
                    description: "Economic mechanisms and TFP",
                    nodes: [2, 3, 4],
                    icon: "üìä"
                },
                {
                    name: "Tactical Shifts",
                    description: "Organizational and operational changes",
                    nodes: [5, 6, 7],
                    icon: "‚öôÔ∏è"
                },
                {
                    name: "Sector Evidence",
                    description: "Empirical data and sector impacts",
                    nodes: [8, 9, 10, 11, 12],
                    icon: "üìà"
                },
                {
                    name: "Systemic Impact",
                    description: "Long-term structural consequences",
                    nodes: [13, 14, 15],
                    icon: "üîÆ"
                }
            ];

            const stageProgress = (index) => {
                if (currentStage > index) return 'completed';
                if (currentStage === index) return 'active';
                return 'pending';
            };

            const getCardStyle = (node) => {
                const depth = node.true_depth;
                if (depth >= 8.5) return 'gradient-border-animated';
                if (depth >= 8.0) return 'border-[var(--aurora-1)] bg-[rgba(99,102,241,0.05)]';
                if (depth >= 7.5) return 'border-[var(--nova-1)]';
                return '';
            };

            const getProgressColor = (node) => {
                const depth = node.true_depth;
                if (depth >= 8.5) return '#6366f1';
                if (depth >= 8.0) return '#06b6d4';
                return '#737373';
            };

            return (
                <div className="max-w-[1600px] mx-auto space-y-6">
                    <header className="mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h1 className="text-4xl font-bold mb-2 text-gradient aurora">
                                    Progressive Timeline Flow
                                </h1>
                                <p className="text-[var(--color-text-secondary)] text-lg">
                                    Experiment 13: Narrative progression from thesis to systemic impact
                                </p>
                            </div>
                            <div className="flex gap-2">
                                <a href="page12.html" className="btn btn-secondary px-4 py-2 rounded-lg text-sm">‚Üê Prev</a>
                                <a href="page14.html" className="btn btn-secondary px-4 py-2 rounded-lg text-sm">Next ‚Üí</a>
                            </div>
                        </div>

                        {/* Stage Controls */}
                        <div className="bg-[var(--color-surface-elevated)] rounded-xl border border-[var(--color-border-base)] p-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <button 
                                        onClick={() => setCurrentStage(Math.max(0, currentStage - 1))}
                                        disabled={currentStage === 0}
                                        className="btn btn-tertiary px-3 py-1 rounded-lg disabled:opacity-30"
                                    >
                                        ‚Üê Back
                                    </button>
                                    <span className="font-bold text-gradient nova">
                                        Stage {currentStage + 1} of {stages.length}: {stages[currentStage].name}
                                    </span>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="flex gap-1">
                                        {stages.map((_, idx) => (
                                            <div 
                                                key={idx}
                                                className={`w-8 h-2 rounded-full transition-all ${stageProgress(idx) === 'completed' ? 'bg-[var(--aurora-1)]' : stageProgress(idx) === 'active' ? 'bg-[var(--nova-1)] h-3' : 'bg-[var(--color-border-subtle)]'}`}
                                            ></div>
                                        ))}
                                    </div>
                                    <button 
                                        onClick={() => setCurrentStage(Math.min(stages.length - 1, currentStage + 1))}
                                        disabled={currentStage === stages.length - 1}
                                        className="btn btn-tertiary px-3 py-1 rounded-lg disabled:opacity-30"
                                    >
                                        Next ‚Üí
                                    </button>
                                </div>
                            </div>
                            <p className="text-xs text-[var(--color-text-secondary)] mt-2">
                                {stages[currentStage].description}
                            </p>
                        </div>
                    </header>

                    {/* Timeline View */}
                    <div className="flex gap-8 items-start">
                        {/* Stage Column */}
                        <div className="w-32 sticky top-8 space-y-4">
                            <div className="text-5xl text-center">{stages[currentStage].icon}</div>
                            <div className="text-center">
                                <div className="text-sm font-bold text-[var(--color-text-secondary)]">Total Nodes</div>
                                <div className="text-2xl font-bold text-gradient aurora">{stages[currentStage].nodes.length}</div>
                            </div>
                            <div className="text-center">
                                <div className="text-xs text-[var(--color-text-tertiary)]">Avg Depth</div>
                                <div className="font-mono text-sm">
                                    {(stages[currentStage].nodes
                                        .map(id => GRAPH_DATA.find(n => n.id === id).true_depth)
                                        .reduce((a, b) => a + b, 0) / stages[currentStage].nodes.length
                                    ).toFixed(1)}
                                </div>
                            </div>
                        </div>

                        {/* Node Cards Column */}
                        <div className="flex-1 space-y-6">
                            {stages[currentStage].nodes.map((nodeId, idx) => {
                                const node = GRAPH_DATA.find(n => n.id === nodeId);
                                const isExpanded = true; // Always show details in timeline view
                                
                                return (
                                    <div key={node.id} className="flex gap-4 items-start">
                                        {/* Connector */}
                                        <div className="flex flex-col items-center">
                                            <div className={`w-4 h-4 rounded-full border-2 ${idx === 0 ? 'border-[var(--aurora-1)] bg-[var(--color-background-primary)]' : 'border-[var(--color-border-strong)] bg-[var(--color-background-secondary)]'}`}></div>
                                            {idx < stages[currentStage].nodes.length - 1 && (
                                                <div className={`w-0.5 flex-1 ${idx < currentStage ? 'bg-gradient-to-b from-[var(--aurora-1)] to-transparent' : 'bg-[var(--color-border-subtle)]'}`}></div>
                                            )}
                                        </div>

                                        {/* Card */}
                                        <Card className={`flex-1 ${getCardStyle(node)} hover:shadow-[var(--elevation-lg)] transition-all`}>
                                            <div className="flex items-start justify-between mb-2">
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xs font-mono px-2 py-0.5 bg-[var(--color-background-tertiary)] rounded text-[var(--color-text-tertiary)]">
                                                        #{String(node.id).padStart(2, '0')}
                                                    </span>
                                                    {node.topic.includes("Thesis") && (
                                                        <span className="text-xs px-2 py-0.5 bg-[var(--aurora-1)] text-[var(--color-text-inverse)] rounded-full font-bold">
                                                            CORE
                                                        </span>
                                                    )}
                                                    {node.topic.includes("Crisis") && (
                                                        <span className="text-xs px-2 py-0.5 bg-[var(--ember-1)] text-[var(--color-text-inverse)] rounded-full font-bold">
                                                            CRITICAL
                                                        </span>
                                                    )}
                                                </div>
                                                <div className="flex gap-2">
                                                    <div className="flex flex-col items-end gap-1">
                                                        <span className="text-[10px] text-[var(--color-text-tertiary)]">Depth</span>
                                                        <div className="flex items-center gap-1">
                                                            <div 
                                                                className="h-1.5 rounded-full"
                                                                style={{ 
                                                                    width: '40px', 
                                                                    backgroundColor: getProgressColor(node) 
                                                                }}
                                                            ></div>
                                                            <span className="font-mono text-xs font-bold">{node.true_depth}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <h3 className="text-lg font-bold mb-1 text-[var(--color-text-primary)]">
                                                {node.topic}
                                            </h3>

                                            <p className="text-sm text-[var(--color-text-secondary)] mb-3">
                                                {node.topic_summary}
                                            </p>

                                            {/* Progressive Disclosure - Always visible in timeline */}
                                            <div className="grid grid-cols-2 gap-3 text-xs">
                                                <div className="bg-[var(--color-background-tertiary)] p-2 rounded">
                                                    <div className="text-[10px] text-[var(--color-text-tertiary)] font-bold mb-1">Analysis</div>
                                                    <div className="text-[var(--color-text-primary)] line-clamp-3">
                                                        {node.extended_summary}
                                                    </div>
                                                </div>
                                                <div className="space-y-2">
                                                    <div className="flex items-center justify-between bg-[var(--color-surface-base)] p-2 rounded">
                                                        <span className="text-[10px] text-[var(--color-text-tertiary)]">Cognitive</span>
                                                        <span className="font-mono font-bold">{node.cognitive}</span>
                                                    </div>
                                                    <div className="flex items-center justify-between bg-[var(--color-surface-base)] p-2 rounded">
                                                        <span className="text-[10px] text-[var(--color-text-tertiary)]">Epistemic</span>
                                                        <span className="font-mono font-bold">{node.epistemic}</span>
                                                    </div>
                                                    <div className="flex items-center justify-between bg-[var(--color-surface-base)] p-2 rounded">
                                                        <span className="text-[10px] text-[var(--color-text-tertiary)]">Causal</span>
                                                        <span className="font-mono font-bold">{node.causal}</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Signals */}
                                            {node.signals.grounding.length > 0 && (
                                                <div className="mt-3 pt-3 border-t border-[var(--color-border-subtle)]">
                                                    <div className="text-[10px] text-[var(--color-text-tertiary)] font-bold mb-1">Key Signals:</div>
                                                    <div className="flex flex-wrap gap-1">
                                                        {node.signals.grounding.slice(0, 3).map((s, i) => (
                                                            <span key={i} className="px-2 py-0.5 text-[10px] bg-[var(--color-surface-base)] border border-[var(--color-border-subtle)] rounded-full text-[var(--color-text-secondary)]">
                                                                {s}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </Card>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Navigation Hint */}
                    <div className="text-center text-xs text-[var(--color-text-tertiary)] py-4">
                        Use the controls above to navigate through the narrative stages
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
