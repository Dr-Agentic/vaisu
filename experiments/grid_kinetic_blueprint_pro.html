<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaisu - Kinetic Blueprint Pro</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #f8fafc;
            --primary: #2563eb;
            --secondary: #a855f7;
            --accent: #db2777;
            --border: #e2e8f0;
        }
        
        body { 
            background-color: var(--bg); 
            color: #0f172a; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        .connection-path {
            fill: none;
            stroke: #cbd5e1;
            stroke-width: 1.5;
            opacity: 0.2;
            transition: all 0.4s ease;
        }

        .connection-path.active {
            stroke: var(--primary);
            stroke-width: 3;
            opacity: 0.8;
            stroke-dasharray: 8 8;
            animation: flow 1s linear infinite;
        }

        @keyframes flow {
            from { stroke-dashoffset: 16; }
            to { stroke-dashoffset: 0; }
        }

        .blueprint-grid {
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        const { motion, AnimatePresence } = window.Motion;

        // --- Full Data ---
        const RAW_DATA = {
            "entities": [
                { "id": "entity-1", "text": "Strategic Cloud Partnership Services", "type": "concept", "importance": 1, "context": "Core business service offered, helping maximize cloud vendor relationships.", "mentions": ["Strategic Cloud Partnership Services"] },
                { "id": "entity-2", "text": "AWS", "type": "organization", "importance": 0.9, "context": "Example cloud vendor in business relationships.", "mentions": ["AWS"] },
                { "id": "entity-3", "text": "B2B Consulting", "type": "concept", "importance": 0.8, "context": "Description of the service type provided.", "mentions": ["B2B consulting service"] },
                { "id": "entity-4", "text": "Webflow", "type": "product", "importance": 0.95, "context": "Hybrid platform recommended as best overall for website transformation.", "mentions": ["Webflow"] },
                { "id": "entity-9", "text": "Framer", "type": "product", "importance": 1, "context": "Recommended DIY platform for most modern design and speed to market.", "mentions": ["Framer"] },
                { "id": "entity-11", "text": "WordPress", "type": "product", "importance": 0.7, "context": "Flexible DIY platform with Elementor for customization.", "mentions": ["WordPress"] },
                { "id": "entity-7", "text": "SEO", "type": "concept", "importance": 0.7, "context": "Search engine optimization capabilities highlighted across options.", "mentions": ["SEO"] },
                { "id": "entity-23", "text": "$14-29/month", "type": "metric", "importance": 0.4, "context": "Cost estimate for Webflow option.", "mentions": ["$14-29/month"] },
                { "id": "entity-25", "text": "$5-15/month", "type": "metric", "importance": 0.5, "context": "Low cost for recommended Framer option.", "mentions": ["$5-15/month"] }
            ],
            "relationships": [
                { "id": "rel-1", "source": "entity-1", "target": "entity-2", "type": "relates-to", "strength": 0.9 },
                { "id": "rel-2", "source": "entity-1", "target": "entity-3", "type": "part-of", "strength": 1 },
                { "id": "rel-16", "source": "entity-1", "target": "entity-9", "type": "uses", "strength": 0.9 },
                { "id": "rel-3", "source": "entity-4", "target": "entity-1", "type": "competitor", "strength": 0.8 },
                { "id": "rel-4", "source": "entity-4", "target": "entity-7", "type": "uses", "strength": 0.8 },
                { "id": "rel-7", "source": "entity-4", "target": "entity-23", "type": "requires", "strength": 0.9 },
                { "id": "rel-10", "source": "entity-11", "target": "entity-1", "type": "alternative", "strength": 0.9 }
            ]
        };

        const CONFIG = {
            concept: { color: '#a855f7', bg: 'bg-purple-50', border: 'border-purple-200' },
            organization: { color: '#3b82f6', bg: 'bg-blue-50', border: 'border-blue-200' },
            product: { color: '#f97316', bg: 'bg-orange-50', border: 'border-orange-200' },
            metric: { color: '#10b981', bg: 'bg-emerald-50', border: 'border-emerald-200' }
        };

        const CardNode = ({ node, isSelected, isRelated, isDimmed, onClick, innerRef }) => {
            const [isHovered, setIsHovered] = useState(false);
            const cfg = CONFIG[node.type] || CONFIG.concept;

            return (
                <motion.div
                    ref={innerRef}
                    layout
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                    onClick={() => onClick(node.id)}
                    className={`
                        relative z-20 w-72 rounded-3xl border-2 cursor-pointer overflow-hidden
                        transition-all duration-500 bg-white
                        ${isSelected ? 'border-blue-600 shadow-2xl shadow-blue-100' : isRelated ? 'border-pink-400 shadow-xl shadow-pink-50' : 'border-slate-200'}
                        ${isDimmed ? 'opacity-40 grayscale-[0.5] scale-95 blur-[0.5px]' : 'opacity-100'}
                    `}
                >
                    {/* Importance Telemetry */}
                    <div className="px-5 py-3 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                        <span className="font-mono text-[9px] font-bold text-slate-400 tracking-widest">
                            UID_{node.id.split('-')[1]}
                        </span>
                        <div className="flex gap-0.5">
                            {[...Array(5)].map((_, i) => (
                                <div 
                                    key={i} 
                                    className={`w-1 h-2 rounded-full ${i < Math.round(node.importance * 5) ? 'bg-blue-500' : 'bg-slate-200'}`} 
                                />
                            ))}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="p-5">
                        <div className="flex items-center gap-2 mb-3">
                            <span className={`px-2 py-0.5 rounded-full text-[9px] font-black uppercase tracking-tighter ${cfg.bg} border ${cfg.border}`} style={{ color: cfg.color }}>
                                {node.type}
                            </span>
                            {node.importance > 0.9 && (
                                <span className="text-[9px] font-bold text-slate-400 uppercase tracking-widest bg-white shadow-sm border px-2 py-0.5 rounded-full">Primary</span>
                            )}
                        </div>
                        <h3 className="text-lg font-extrabold text-slate-900 leading-tight mb-4">{node.text}</h3>
                        
                        {/* Separator / Divider */}
                        <div className="relative h-px bg-slate-100 mb-4 overflow-visible">
                            <div className="absolute left-0 -top-1 w-2 h-2 rounded-full border border-slate-200 bg-white" />
                            <div className="absolute right-0 -top-1 w-2 h-2 rounded-full border border-slate-200 bg-white" />
                        </div>

                        {/* Progressive Disclosure Section */}
                        <AnimatePresence>
                            {(isHovered || isSelected) && (
                                <motion.div
                                    initial={{ height: 0, opacity: 0 }}
                                    animate={{ height: 'auto', opacity: 1 }}
                                    exit={{ height: 0, opacity: 0 }}
                                    transition={{ duration: 0.4, ease: [0.23, 1, 0.32, 1] }}
                                    className="overflow-hidden"
                                >
                                    <div className="space-y-4 pb-2">
                                        <div>
                                            <label className="text-[9px] font-black text-slate-300 uppercase tracking-widest block mb-1.5">Contextual Logic</label>
                                            <p className="text-xs text-slate-500 leading-relaxed italic">
                                                "{node.context}"
                                            </p>
                                        </div>
                                        {node.mentions && (
                                            <div>
                                                <label className="text-[9px] font-black text-slate-300 uppercase tracking-widest block mb-1.5">Source Mentions</label>
                                                <div className="flex flex-wrap gap-1.5">
                                                    {node.mentions.map((m, i) => (
                                                        <span key={i} className="text-[10px] font-mono bg-slate-50 text-slate-400 px-2 py-0.5 rounded border border-slate-100 truncate max-w-full">
                                                            {m}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </motion.div>
                            )}
                        </AnimatePresence>
                        
                        {/* Summary indicator when collapsed */}
                        {!isHovered && !isSelected && (
                            <div className="flex justify-center">
                                <div className="flex gap-1">
                                    <div className="w-1 h-1 rounded-full bg-slate-200" />
                                    <div className="w-1 h-1 rounded-full bg-slate-200" />
                                    <div className="w-1 h-1 rounded-full bg-slate-200" />
                                </div>
                            </div>
                        )}
                    </div>
                </motion.div>
            );
        };

        const App = () => {
            const [selectedId, setSelectedId] = useState('entity-1');
            const [coords, setCoords] = useState({});
            const cardRefs = useRef({});

            // Recalculate coordinates using ResizeObserver to track card expansions
            const updateCoords = useCallback(() => {
                const newCoords = {};
                RAW_DATA.entities.forEach(e => {
                    const el = cardRefs.current[e.id];
                    if (el) {
                        const rect = el.getBoundingClientRect();
                        newCoords[e.id] = {
                            x: rect.left + window.scrollX + rect.width / 2,
                            y: rect.top + window.scrollY + rect.height / 2
                        };
                    }
                });
                setCoords(newCoords);
            }, []);

            useEffect(() => {
                const observers = RAW_DATA.entities.map(e => {
                    const el = cardRefs.current[e.id];
                    if (el) {
                        const observer = new ResizeObserver(() => updateCoords());
                        observer.observe(el);
                        return observer;
                    }
                    return null;
                });
                
                updateCoords();
                window.addEventListener('resize', updateCoords);
                return () => {
                    observers.forEach(o => o?.disconnect());
                    window.removeEventListener('resize', updateCoords);
                };
            }, [updateCoords]);

            const neighbors = useMemo(() => {
                if (!selectedId) return new Set();
                const n = new Set();
                RAW_DATA.relationships.forEach(r => {
                    if (r.source === selectedId) n.add(r.target);
                    if (r.target === selectedId) n.add(r.source);
                });
                return n;
            }, [selectedId]);

            // Organize into rows/cols manually for the blueprint grid
            const gridLayout = useMemo(() => {
                const columns = [[], [], [], []];
                RAW_DATA.entities.forEach((e, i) => {
                    // Simple logic: e1 center, rest distribute
                    if (e.id === 'entity-1') columns[1].push(e);
                    else if (e.type === 'product') columns[2].push(e);
                    else if (e.type === 'metric') columns[3].push(e);
                    else columns[0].push(e);
                });
                return columns;
            }, []);

            return (
                <div className="min-h-screen p-20 blueprint-grid relative flex flex-col">
                    <header className="mb-20 flex justify-between items-end relative z-30">
                        <div>
                            <div className="flex items-center gap-4 mb-2">
                                <div className="w-12 h-12 rounded-2xl bg-blue-600 flex items-center justify-center text-white shadow-2xl shadow-blue-200 border-2 border-white">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                                </div>
                                <h1 className="text-5xl font-black tracking-tighter text-slate-900 uppercase italic">Blueprint_Pro</h1>
                            </div>
                            <p className="text-slate-400 font-mono text-[10px] tracking-[0.4em] uppercase ml-1">Advanced Neural Semantic Topology v3.4</p>
                        </div>
                        <div className="flex items-center gap-10 bg-white/80 backdrop-blur px-8 py-4 rounded-3xl border border-slate-200 shadow-xl">
                            <div className="flex flex-col gap-1">
                                <span className="text-[9px] font-black text-slate-300 uppercase tracking-widest">Active Signal</span>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-blue-600 animate-pulse" />
                                    <span className="text-xs font-bold text-slate-700">Source Focus</span>
                                </div>
                            </div>
                            <div className="w-px h-8 bg-slate-100" />
                            <div className="flex flex-col gap-1">
                                <span className="text-[9px] font-black text-slate-300 uppercase tracking-widest">Linked Node</span>
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-pink-500" />
                                    <span className="text-xs font-bold text-slate-700">Relational Hit</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* SVG Connections Layer */}
                    <svg className="fixed inset-0 w-full h-full pointer-events-none z-10 overflow-visible">
                        {RAW_DATA.relationships.map(r => {
                            const s = coords[r.source];
                            const t = coords[r.target];
                            if (!s || !t) return null;

                            const isActive = selectedId === r.source || selectedId === r.target;
                            
                            // Calculate simple bezier path
                            const dx = t.x - s.x;
                            const dy = t.y - s.y;
                            const d = `M ${s.x} ${s.y} C ${s.x + dx*0.5} ${s.y}, ${s.x + dx*0.5} ${t.y}, ${t.x} ${t.y}`;

                            return (
                                <g key={r.id}>
                                    <path 
                                        d={d} 
                                        className={`connection-path ${isActive ? 'active' : ''}`}
                                    />
                                    {isActive && (
                                        <g transform={`translate(${(s.x + t.x)/2}, ${(s.y + t.y)/2})`}>
                                            <rect x="-45" y="-10" width="90" height="20" rx="10" fill="white" stroke="#e2e8f0" strokeWidth="1" />
                                            <text textAnchor="middle" dy="4" className="text-[8px] font-black fill-blue-600 font-mono uppercase tracking-tighter">
                                                {r.type}
                                            </text>
                                        </g>
                                    )}
                                </g>
                            );
                        })}
                    </svg>

                    <div className="grid grid-cols-4 gap-12 relative z-20">
                        {gridLayout.map((column, colIdx) => (
                            <div key={colIdx} className="flex flex-col gap-8">
                                <div className="text-[10px] font-black text-slate-300 uppercase tracking-[0.5em] mb-4 border-b border-slate-100 pb-2">Sector_0{colIdx}</div>
                                {column.map(node => (
                                    <CardNode 
                                        key={node.id}
                                        node={node}
                                        innerRef={el => cardRefs.current[node.id] = el}
                                        isSelected={selectedId === node.id}
                                        isRelated={neighbors.has(node.id)}
                                        isDimmed={selectedId && selectedId !== node.id && !neighbors.has(node.id)}
                                        onClick={setSelectedId}
                                    />
                                ))}
                            </div>
                        ))}
                    </div>

                    {/* Guide Overlay */}
                    <div className="fixed bottom-10 left-10 text-[9px] font-mono text-slate-300 bg-white/50 backdrop-blur px-4 py-2 rounded-full border border-slate-100 pointer-events-none">
                        PROTOTYPE_BUILD_V3.4 // KINETIC_RESIZE_ENGINE_ACTIVE
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>